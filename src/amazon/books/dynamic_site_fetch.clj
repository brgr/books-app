(ns amazon.books.dynamic-site-fetch)

(require
  '[clojure.string :as string]
  '[crouton.html :as html])

(use 'etaoin.api)
(require '[etaoin.keys :as k])
(require '[crouton.html :as html])


; TODO: dynamically load amazon books page
; see:
; https://github.com/tmarble/webica/blob/master/examples/lmgtfy
; https://towardsdatascience.com/data-science-skills-web-scraping-javascript-using-python-97a29738353f

(def driver (firefox {:headless true}))
(go driver "https://amazon.de/hz/wishlist/ls/13XXXLP6RR1X9/ref=nav_wishlist_lists_1?_encoding=UTF8&type=wishlist")

(wait-visible driver [{:id :twotabsearchtextbox}])

;(println (get-element-inner-html driver {:id :wishlist-page}))
;(wait-exists driver {:class :wl-see-more})
;(println "contains? " (.contains (get-element-inner-html driver {:id :wishlist-page}) "wl-see-more")) ; this works!

(defn more_books_available? [driver]
  (.contains (get-element-inner-html driver {:id :wishlist-page}) "wl-see-more"))
; falls das nicht geht:
; es gibt auch eine "showMoreUrl" -> STRG+F in HTML file! -> dann URL laden -> nächste Entries

;(scroll-down driver 2000)
;(scroll-query driver {:tag :div :class :wl-see-more-spinner})
;(wait-invisible driver {:class :wl-see-more-spinner})
;(scroll-query driver {:class :wl-see-more-spinner})

(defn load_all_books [driver]
  (while (more_books_available? driver)
    (scroll-query driver {:id :navBackToTop})
    (scroll-up driver 300)))

(load_all_books driver)

;(def wishlist_html (html/parse-string (get-element-inner-html driver {:id :wishlist-page})))
;(def wishlist_items
;  (map (partial get-element-inner-html-el driver) (query-all driver {:xpath "//div[starts-with(@id, 'item_')]"})))


; using this code script from reddit:
; https://old.reddit.com/r/amazon/comments/7paenb/amazon_wishlist_web_scraper/

(def whole_html (get-source driver))
(spit "whole_html.html" whole_html)

;(def wishlist_items_reddit
;  (map (partial get-element-inner-html-el driver)
;       (query-all driver {:xpath "//li[contains(@class, 'g-item-sortable')]"})))
;
;(spit "itemNames_reddit.html" (pr-str wishlist_items_reddit))


(comment "
  wishlist_items is now 300+ items, each containing (likely, not always) a book. These are the elements that a book
  item has:
  .g-itemImage --> but there is no image link there?
")



; TODO: map wishlist_html and get relevant information out of it

; This is what three exemplary entries look like, as taken from the parsed (wishlist-page) HTML above

;{:tag :div, :attrs {:id itemInfo_I35PBU5QP6Q8IS, :class a-fixed-right-grid-col g-item-details a-col-left, :style padding-right:10%;float:left;}, :content [{:tag :div, :attrs {:class a-row}, :content [{:tag :div, :attrs {:class a-column a-span12 g-span12when-narrow g-span7when-wide}, :content [{:tag :div, :attrs {:class a-row a-size-small}, :content [{:tag :h3, :attrs {:class a-size-base}, :content [{:tag :a, :attrs {:id itemName_I35PBU5QP6Q8IS, :class a-link-normal, :title Die Angst vor den anderen: Ein Essay über Migration und Panikmache (edition suhrkamp), :href /dp/3518072587/?coliid=I35PBU5QP6Q8IS&colid=13XXXLP6RR1X9&psc=1&ref_=lv_vv_lig_dp_it}, :content [Die Angst vor den anderen: Ein Essay über Migration und Panikmache (edition suhrkamp)]}]} {:tag :span, :attrs {:id item-byline-I35PBU5QP6Q8IS, :class a-size-base}, :content [von: Zygmunt Bauman, Michael Bischoff (Taschenbuch)]}]} {:tag :div, :attrs {:class a-row a-spacing-small a-size-small}, :content [  {:tag :div, :attrs {:class a-row}, :content [  {:tag :span, :attrs {:class a-declarative, :data-action a-popover, :data-a-popover {"cache":"true","max-width":"700","data":{"itemId":"I35PBU5QP6Q8IS","isGridViewInnerPopover":""},"closeButton":"false","name":"review-hist-pop.3518072587","header":"","position":"triggerBottom","url":"/gp/customer-reviews/widgets/average-customer-review/popover/?asin=3518072587&contextId=wishlistList&link=1&seeall=1&ref_=lv_vv_lig_rh_rst"}}, :content [  {:tag :a, :attrs {:class a-link-normal g-visible-js reviewStarsPopoverLink, :href #}, :content [  {:tag :i, :attrs {:id review_stars_I35PBU5QP6Q8IS, :class a-icon a-icon-star-small a-star-small-4-5}, :content [{:tag :span, :attrs {:class a-icon-alt}, :content [4.3 von 5 Sternen]}]} {:tag :i, :attrs {:class a-icon a-icon-popover, :role img}, :content nil}  ]}  ]}   {:tag :a, :attrs {:class a-link-normal g-visible-no-js, :href /product-reviews/3518072587/?colid=13XXXLP6RR1X9&coliid=I35PBU5QP6Q8IS&showViewpoints=1&ref_=lv_vv_lig_pr_rc}, :content [  {:tag :i, :attrs {:class a-icon a-icon-star-small a-star-small-4-5}, :content [{:tag :span, :attrs {:class a-icon-alt}, :content [4.3 von 5 Sternen]}]}  ]}   {:tag :a, :attrs {:id review_count_I35PBU5QP6Q8IS, :class a-size-base a-link-normal, :href /product-reviews/3518072587/?colid=13XXXLP6RR1X9&coliid=I35PBU5QP6Q8IS&showViewpoints=1&ref_=lv_vv_lig_pr_rc}, :content [ 10 ]}  ]}   {:tag :div, :attrs {:class a-row}, :content [  {:tag :div, :attrs {:data-item-prime-info {"id":"I35PBU5QP6Q8IS","asin":"3518072587"}, :class a-section price-section}, :content [  {:tag :span, :attrs {:id itemPrice_I35PBU5QP6Q8IS, :class a-price, :data-a-size m, :data-a-color base}, :content [{:tag :span, :attrs {:class a-offscreen}, :content [12,00 €]} {:tag :span, :attrs {:aria-hidden true}, :content [{:tag :span, :attrs {:class a-price-symbol}, :content [€]} {:tag :span, :attrs {:class a-price-whole}, :content [12 {:tag :span, :attrs {:class a-price-decimal}, :content [,]}]} {:tag :span, :attrs {:class a-price-fraction}, :content [00]}]}]}   {:tag :span, :attrs {:class a-letter-space}, :content nil}   {:tag :i, :attrs {:class a-icon a-icon-prime a-icon-small, :role img}, :content nil}  ]}  ]}   {:tag :div, :attrs {:class a-row itemUsedAndNew}, :content [{:tag :a, :attrs {:id used-and-new_I35PBU5QP6Q8IS, :class a-link-normal a-declarative itemUsedAndNewLink, :href /gp/offer-listing/3518072587/?colid=13XXXLP6RR1X9&coliid=I35PBU5QP6Q8IS&ref_=lv_vv_lig_uan_ol}, :content [34 Angebote]} {:tag :span, :attrs {:class a-letter-space}, :content nil} ab  {:tag :span, :attrs {:class a-color-price itemUsedAndNewPrice}, :content [7,83 €]}]}]}]} {:tag :div, :attrs {:class a-column a-span12 g-span12when-narrow g-span5when-wide g-item-comment a-hidden a-span-last}, :content [{:tag :div, :attrs {:class a-box a-box-normal a-color-alternate-background quotes-bubble}, :content [{:tag :div, :attrs {:class a-box-inner}, :content [{:tag :div, :attrs {:id itemCommentRow_I35PBU5QP6Q8IS, :class a-row a-hidden}, :content [{:tag :span, :attrs {:class wrap-text}, :content [{:tag :span, :attrs {:id itemComment_I35PBU5QP6Q8IS, :class g-comment-quote a-text-quote}, :content nil}]}]} {:tag :div, :attrs {:class a-row g-item-comment-row}, :content [{:tag :span, :attrs {:id itemPriorityRow_I35PBU5QP6Q8IS, :class a-size-small a-hidden}, :content [Wie sehr gewünscht: {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPriorityLabel_I35PBU5QP6Q8IS, :class a-size-small dropdown-priority item-priority-medium}, :content [Würde mich freuen]} {:tag :span, :attrs {:id itemPriority_I35PBU5QP6Q8IS, :class a-hidden}, :content [0]}]} {:tag :i, :attrs {:class a-icon a-icon-text-separator g-priority-seperator a-hidden, :role img}, :content nil} {:tag :span, :attrs {:id itemQuantityRow_I35PBU5QP6Q8IS, :class a-size-small a-hidden}, :content [{:tag :span, :attrs {:class aok-inline-block}, :content [{:tag :span, :attrs {:id itemRequestedLabel_I35PBU5QP6Q8IS}, :content [Gewünscht:]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemRequested_I35PBU5QP6Q8IS}, :content [1]}]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPurchasedSection_I35PBU5QP6Q8IS, :class aok-inline-block}, :content [{:tag :span, :attrs {:id itemPurchasedLabel_I35PBU5QP6Q8IS}, :content [Erhalten:]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPurchased_I35PBU5QP6Q8IS}, :content [0]}]}]}]} {:tag :div, :attrs {:class quotes-bubble-arrow}, :content nil}  ]}]}]}]}]} {:tag :div, :attrs {:id itemAction_I35PBU5QP6Q8IS, :class a-fixed-right-grid-col dateAddedText a-col-right, :style width:220px;margin-right:-220px;float:left;}, :content [{:tag :span, :attrs {:id itemAddedDate_I35PBU5QP6Q8IS, :class a-size-small}, :content [Artikel hinzugefügt 2. August 2017 ]} {:tag :div, :attrs {:class a-button-stack a-spacing-top-small}, :content [{:tag :span, :attrs {:class a-declarative, :data-action add-to-cart, :data-add-to-cart {"listID":"13XXXLP6RR1X9","canonicalAsin":"3518072587","itemID":"I35PBU5QP6Q8IS","quantity":"1","merchantID":"A3JWKAKR8XB7XF","price":"12.00","productGroupID":"gl_book","offerID":"gb%2B8rLWde79q18M0kkIVimiHTUiP3u2A7OCL9IYCiDkWlLVM3X8y%2BxYEFQ2fpv7953JHm4HZ%2FadxfAHn%2Fvq%2F38ZPsE3gLLzR","isGift":"1","asin":"3518072587","promotionID":""}, :id pab-declarative-I35PBU5QP6Q8IS}, :content [  {:tag :span, :attrs {:id pab-I35PBU5QP6Q8IS, :class a-button a-button-normal a-button-primary wl-info-aa_add_to_cart}, :content [{:tag :span, :attrs {:class a-button-inner}, :content [{:tag :a, :attrs {:href /gp/item-dispatch?registryID.1=13XXXLP6RR1X9&registryItemID.1=I35PBU5QP6Q8IS&offeringID.1=gb%252B8rLWde79q18M0kkIVimiHTUiP3u2A7OCL9IYCiDkWlLVM3X8y%252BxYEFQ2fpv7953JHm4HZ%252FadxfAHn%252Fvq%252F38ZPsE3gLLzR&session-id=258-1351578-9709240&isGift=1&submit.addToCart=1&quantity.1=1&ref_=lv_vv_lig_pab, :class a-button-text a-text-center, :role button}, :content [ In den Warenkorb ]}]}]}   {:tag :span, :attrs nil, :content nil}  ]} {:tag :div, :attrs {:class a-row a-spacing-small}, :content [{:tag :div, :attrs {:class a-row a-spacing-small g-touch-hide}, :content [{:tag :a, :attrs {:id lnkReserve_I35PBU5QP6Q8IS, :class a-link-normal, :href https://www.amazon.de/ap/signin?clientContext=257-6828315-2108648&openid.return_to=https%3A%2F%2Fwww.amazon.de%2Fhz%2Fwishlist%2Fls%2F13XXXLP6RR1X9&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=amzn_wishlist_desktop_de&openid.mode=checkid_setup&marketPlaceId=A1PA6795UKMFR9&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&pageId=Amazon&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.pape.max_auth_age=900&siteState=clientContext%3D258-1351578-9709240%2CsourceUrl%3Dhttps%253A%252F%252Fwww.amazon.de%252Fhz%252Fwishlist%252Fls%252F13XXXLP6RR1X9%2Csignature%3Dz2mQdthDj2F9LkayNhoi0PHTbTk2kj3D}, :content [Dieses Geschenk woanders kaufen?]}]} {:tag :div, :attrs {:class a-row a-spacing-small g-touch-show}, :content [{:tag :div, :attrs {:class a-section a-spacing-top-small}, :content [{:tag :a, :attrs {:id lnkReserve_I35PBU5QP6Q8IS, :class a-link-normal, :href https://www.amazon.de/ap/signin?clientContext=257-6828315-2108648&openid.return_to=https%3A%2F%2Fwww.amazon.de%2Fhz%2Fwishlist%2Fls%2F13XXXLP6RR1X9&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=amzn_wishlist_desktop_de&openid.mode=checkid_setup&marketPlaceId=A1PA6795UKMFR9&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&pageId=Amazon&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.pape.max_auth_age=900&siteState=clientContext%3D258-1351578-9709240%2CsourceUrl%3Dhttps%253A%252F%252Fwww.amazon.de%252Fhz%252Fwishlist%252Fls%252F13XXXLP6RR1X9%2Csignature%3Dz2mQdthDj2F9LkayNhoi0PHTbTk2kj3D}, :content [Dieses Geschenk woanders kaufen?]}]}]}]}]}]}]}]}]}]}]}]}]}]} {:tag :li, :attrs {:data-id 13XXXLP6RR1X9, :data-itemid I3N1XLR9D84YG7, :data-price 16.0, :data-reposition-action-params {"itemExternalId":"ASIN:3518464450|A1PA6795UKMFR9","listType":"wishlist","sid":"258-1351578-9709240"}, :class a-spacing-none g-item-sortable}, :content [{:tag :span, :attrs {:class a-list-item}, :content [{:tag :hr, :attrs {:class a-spacing-none a-divider-normal}, :content nil} {:tag :div, :attrs {:id item_I3N1XLR9D84YG7, :class a-section}, :content [  {:tag :div, :attrs {:class a-fixed-left-grid a-spacing-none}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-inner, :style padding-left:220px}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-col a-col-left, :style width:220px;margin-left:-220px;float:left;}, :content [{:tag :div, :attrs {:class a-fixed-left-grid}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-inner, :style padding-left:35px}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-col a-col-left, :style width:35px;margin-left:-35px;float:left;}, :content nil} {:tag :div, :attrs {:id itemImage_I3N1XLR9D84YG7, :class a-text-center a-fixed-left-grid-col g-itemImage wl-has-overlay g-item-sortable-padding a-col-right, :style padding-left:0%;float:left;}, :content [{:tag :a, :attrs {:class a-link-normal, :title Kongo: Eine Geschichte (suhrkamp taschenbuch), :href /dp/3518464450/?coliid=I3N1XLR9D84YG7&colid=13XXXLP6RR1X9&psc=1}, :content [{:tag :img, :attrs {:alt Kongo: Eine Geschichte (suhrkamp taschenbuch), :src https://images-na.ssl-images-amazon.com/images/I/415ox10RatL._SS135_.jpg}, :content nil}]}]}]}]}]} {:tag :div, :attrs {:id itemMain_I3N1XLR9D84YG7, :class a-text-left a-fixed-left-grid-col g-item-sortable-padding a-col-right, :style padding-left:0%;float:left;}, :content [{:tag :div, :attrs {:id itemAlertDefault_I3N1XLR9D84YG7, :class a-box a-alert a-alert-error a-hidden a-spacing-mini, :aria-live assertive, :role alert}, :content [{:tag :div, :attrs {:class a-box-inner a-alert-container}, :content [{:tag :h4, :attrs {:class a-alert-heading}, :content [Ein Fehler trat auf, bitte versuchen Sie es zu einem späteren Zeitpunkt erneut]} {:tag :i, :attrs {:class a-icon a-icon-alert}, :content nil} {:tag :div, :attrs {:class a-alert-content}, :content nil}]}]} {:tag :div, :attrs {:id itemAlert_I3N1XLR9D84YG7, :class a-row a-spacing-mini a-hidden}, :content nil} {:tag :div, :attrs {:class a-fixed-right-grid}, :content [{:tag :div, :attrs {:class a-fixed-right-grid-inner, :style padding-right:220px}, :content [
;{:tag :div, :attrs {:id itemInfo_I3N1XLR9D84YG7, :class a-fixed-right-grid-col g-item-details a-col-left, :style padding-right:10%;float:left;}, :content [{:tag :div, :attrs {:class a-row}, :content [{:tag :div, :attrs {:class a-column a-span12 g-span12when-narrow g-span7when-wide}, :content [{:tag :div, :attrs {:class a-row a-size-small}, :content [{:tag :h3, :attrs {:class a-size-base}, :content [{:tag :a, :attrs {:id itemName_I3N1XLR9D84YG7, :class a-link-normal, :title Kongo: Eine Geschichte (suhrkamp taschenbuch), :href /dp/3518464450/?coliid=I3N1XLR9D84YG7&colid=13XXXLP6RR1X9&psc=1&ref_=lv_vv_lig_dp_it}, :content [Kongo: Eine Geschichte (suhrkamp taschenbuch)]}]} {:tag :span, :attrs {:id item-byline-I3N1XLR9D84YG7, :class a-size-base}, :content [von: David Van Reybrouck, Waltraud Hüsmert (Taschenbuch)]}]} {:tag :div, :attrs {:class a-row a-spacing-small a-size-small}, :content [  {:tag :div, :attrs {:class a-row}, :content [  {:tag :span, :attrs {:class a-declarative, :data-action a-popover, :data-a-popover {"cache":"true","max-width":"700","data":{"itemId":"I3N1XLR9D84YG7","isGridViewInnerPopover":""},"closeButton":"false","name":"review-hist-pop.3518464450","header":"","position":"triggerBottom","url":"/gp/customer-reviews/widgets/average-customer-review/popover/?asin=3518464450&contextId=wishlistList&link=1&seeall=1&ref_=lv_vv_lig_rh_rst"}}, :content [  {:tag :a, :attrs {:class a-link-normal g-visible-js reviewStarsPopoverLink, :href #}, :content [  {:tag :i, :attrs {:id review_stars_I3N1XLR9D84YG7, :class a-icon a-icon-star-small a-star-small-5}, :content [{:tag :span, :attrs {:class a-icon-alt}, :content [4.8 von 5 Sternen]}]} {:tag :i, :attrs {:class a-icon a-icon-popover, :role img}, :content nil}  ]}  ]}   {:tag :a, :attrs {:class a-link-normal g-visible-no-js, :href /product-reviews/3518464450/?colid=13XXXLP6RR1X9&coliid=I3N1XLR9D84YG7&showViewpoints=1&ref_=lv_vv_lig_pr_rc}, :content [  {:tag :i, :attrs {:class a-icon a-icon-star-small a-star-small-5}, :content [{:tag :span, :attrs {:class a-icon-alt}, :content [4.8 von 5 Sternen]}]}  ]}   {:tag :a, :attrs {:id review_count_I3N1XLR9D84YG7, :class a-size-base a-link-normal, :href /product-reviews/3518464450/?colid=13XXXLP6RR1X9&coliid=I3N1XLR9D84YG7&showViewpoints=1&ref_=lv_vv_lig_pr_rc}, :content [ 68 ]}  ]}   {:tag :div, :attrs {:class a-row}, :content [  {:tag :div, :attrs {:data-item-prime-info {"id":"I3N1XLR9D84YG7","asin":"3518464450"}, :class a-section price-section}, :content [  {:tag :span, :attrs {:id itemPrice_I3N1XLR9D84YG7, :class a-price, :data-a-size m, :data-a-color base}, :content [{:tag :span, :attrs {:class a-offscreen}, :content [16,00 €]} {:tag :span, :attrs {:aria-hidden true}, :content [{:tag :span, :attrs {:class a-price-symbol}, :content [€]} {:tag :span, :attrs {:class a-price-whole}, :content [16 {:tag :span, :attrs {:class a-price-decimal}, :content [,]}]} {:tag :span, :attrs {:class a-price-fraction}, :content [00]}]}]}   {:tag :span, :attrs {:class a-letter-space}, :content nil}   {:tag :i, :attrs {:class a-icon a-icon-prime a-icon-small, :role img}, :content nil}  ]}  ]}   {:tag :div, :attrs {:class a-row itemUsedAndNew}, :content [{:tag :a, :attrs {:id used-and-new_I3N1XLR9D84YG7, :class a-link-normal a-declarative itemUsedAndNewLink, :href /gp/offer-listing/3518464450/?colid=13XXXLP6RR1X9&coliid=I3N1XLR9D84YG7&ref_=lv_vv_lig_uan_ol}, :content [35 Angebote]} {:tag :span, :attrs {:class a-letter-space}, :content nil} ab  {:tag :span, :attrs {:class a-color-price itemUsedAndNewPrice}, :content [8,08 €]}]}]}]} {:tag :div, :attrs {:class a-column a-span12 g-span12when-narrow g-span5when-wide g-item-comment a-span-last}, :content [{:tag :div, :attrs {:class a-box a-box-normal a-color-alternate-background quotes-bubble}, :content [{:tag :div, :attrs {:class a-box-inner}, :content [{:tag :div, :attrs {:id itemCommentRow_I3N1XLR9D84YG7, :class a-row a-hidden}, :content [{:tag :span, :attrs {:class wrap-text}, :content [{:tag :span, :attrs {:id itemComment_I3N1XLR9D84YG7, :class g-comment-quote a-text-quote}, :content nil}]}]} {:tag :div, :attrs {:class a-row g-item-comment-row}, :content [{:tag :span, :attrs {:id itemPriorityRow_I3N1XLR9D84YG7, :class a-size-small}, :content [Wie sehr gewünscht: {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPriorityLabel_I3N1XLR9D84YG7, :class a-size-small dropdown-priority item-priority-high}, :content [Hätte ich sehr gerne]} {:tag :span, :attrs {:id itemPriority_I3N1XLR9D84YG7, :class a-hidden}, :content [1]}]} {:tag :i, :attrs {:class a-icon a-icon-text-separator g-priority-seperator a-hidden, :role img}, :content nil} {:tag :span, :attrs {:id itemQuantityRow_I3N1XLR9D84YG7, :class a-size-small a-hidden}, :content [{:tag :span, :attrs {:class aok-inline-block}, :content [{:tag :span, :attrs {:id itemRequestedLabel_I3N1XLR9D84YG7}, :content [Gewünscht:]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemRequested_I3N1XLR9D84YG7}, :content [1]}]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPurchasedSection_I3N1XLR9D84YG7, :class aok-inline-block}, :content [{:tag :span, :attrs {:id itemPurchasedLabel_I3N1XLR9D84YG7}, :content [Erhalten:]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPurchased_I3N1XLR9D84YG7}, :content [0]}]}]}]} {:tag :div, :attrs {:class quotes-bubble-arrow}, :content nil}  ]}]}]}]}]} {:tag :div, :attrs {:id itemAction_I3N1XLR9D84YG7, :class a-fixed-right-grid-col dateAddedText a-col-right, :style width:220px;margin-right:-220px;float:left;}, :content [{:tag :span, :attrs {:id itemAddedDate_I3N1XLR9D84YG7, :class a-size-small}, :content [Artikel hinzugefügt 2. August 2017 ]} {:tag :div, :attrs {:class a-button-stack a-spacing-top-small}, :content [{:tag :span, :attrs {:class a-declarative, :data-action add-to-cart, :data-add-to-cart {"listID":"13XXXLP6RR1X9","canonicalAsin":"3518464450","itemID":"I3N1XLR9D84YG7","quantity":"1","merchantID":"A3JWKAKR8XB7XF","price":"16.00","productGroupID":"gl_book","offerID":"1HoznFo4%2BvZ52ifMjbneMN%2BJUdSUIqvR4meKu2bAGID%2BNqYpaC%2Br0gSZ8ynXhzIUXg71ZRbfu9IrmEA7Tj%2B0LpJz4HQLGN31g10WvWcWGUU%3D","isGift":"1","asin":"3518464450","promotionID":""}, :id pab-declarative-I3N1XLR9D84YG7}, :content [  {:tag :span, :attrs {:id pab-I3N1XLR9D84YG7, :class a-button a-button-normal a-button-primary wl-info-aa_add_to_cart}, :content [{:tag :span, :attrs {:class a-button-inner}, :content [{:tag :a, :attrs {:href /gp/item-dispatch?registryID.1=13XXXLP6RR1X9&registryItemID.1=I3N1XLR9D84YG7&offeringID.1=1HoznFo4%252BvZ52ifMjbneMN%252BJUdSUIqvR4meKu2bAGID%252BNqYpaC%252Br0gSZ8ynXhzIUXg71ZRbfu9IrmEA7Tj%252B0LpJz4HQLGN31g10WvWcWGUU%253D&session-id=258-1351578-9709240&isGift=1&submit.addToCart=1&quantity.1=1&ref_=lv_vv_lig_pab, :class a-button-text a-text-center, :role button}, :content [ In den Warenkorb ]}]}]}   {:tag :span, :attrs nil, :content nil}  ]} {:tag :div, :attrs {:class a-row a-spacing-small}, :content [{:tag :div, :attrs {:class a-row a-spacing-small g-touch-hide}, :content [{:tag :a, :attrs {:id lnkReserve_I3N1XLR9D84YG7, :class a-link-normal, :href https://www.amazon.de/ap/signin?clientContext=257-6828315-2108648&openid.return_to=https%3A%2F%2Fwww.amazon.de%2Fhz%2Fwishlist%2Fls%2F13XXXLP6RR1X9&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=amzn_wishlist_desktop_de&openid.mode=checkid_setup&marketPlaceId=A1PA6795UKMFR9&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&pageId=Amazon&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.pape.max_auth_age=900&siteState=clientContext%3D258-1351578-9709240%2CsourceUrl%3Dhttps%253A%252F%252Fwww.amazon.de%252Fhz%252Fwishlist%252Fls%252F13XXXLP6RR1X9%2Csignature%3Dz2mQdthDj2F9LkayNhoi0PHTbTk2kj3D}, :content [Dieses Geschenk woanders kaufen?]}]} {:tag :div, :attrs {:class a-row a-spacing-small g-touch-show}, :content [{:tag :div, :attrs {:class a-section a-spacing-top-small}, :content [{:tag :a, :attrs {:id lnkReserve_I3N1XLR9D84YG7, :class a-link-normal, :href https://www.amazon.de/ap/signin?clientContext=257-6828315-2108648&openid.return_to=https%3A%2F%2Fwww.amazon.de%2Fhz%2Fwishlist%2Fls%2F13XXXLP6RR1X9&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=amzn_wishlist_desktop_de&openid.mode=checkid_setup&marketPlaceId=A1PA6795UKMFR9&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&pageId=Amazon&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.pape.max_auth_age=900&siteState=clientContext%3D258-1351578-9709240%2CsourceUrl%3Dhttps%253A%252F%252Fwww.amazon.de%252Fhz%252Fwishlist%252Fls%252F13XXXLP6RR1X9%2Csignature%3Dz2mQdthDj2F9LkayNhoi0PHTbTk2kj3D}, :content [Dieses Geschenk woanders kaufen?]}]}]}]}]}]}]}]}]}]}]}]}]}]} {:tag :li, :attrs {:data-id 13XXXLP6RR1X9, :data-itemid I1OKX5D9SF936Y, :data-price 18.0, :data-reposition-action-params {"itemExternalId":"ASIN:3518072927|A1PA6795UKMFR9","listType":"wishlist","sid":"258-1351578-9709240"}, :class a-spacing-none g-item-sortable}, :content [{:tag :span, :attrs {:class a-list-item}, :content [{:tag :hr, :attrs {:class a-spacing-none a-divider-normal}, :content nil} {:tag :div, :attrs {:id item_I1OKX5D9SF936Y, :class a-section}, :content [  {:tag :div, :attrs {:class a-fixed-left-grid a-spacing-none}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-inner, :style padding-left:220px}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-col a-col-left, :style width:220px;margin-left:-220px;float:left;}, :content [{:tag :div, :attrs {:class a-fixed-left-grid}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-inner, :style padding-left:35px}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-col a-col-left, :style width:35px;margin-left:-35px;float:left;}, :content nil} {:tag :div, :attrs {:id itemImage_I1OKX5D9SF936Y, :class a-text-center a-fixed-left-grid-col g-itemImage wl-has-overlay g-item-sortable-padding a-col-right, :style padding-left:0%;float:left;}, :content [{:tag :a, :attrs {:class a-link-normal, :title Das metrische Wir: Über die Quantifizierung des Sozialen (edition suhrkamp), :href /dp/3518072927/?coliid=I1OKX5D9SF936Y&colid=13XXXLP6RR1X9&psc=1}, :content [{:tag :img, :attrs {:alt Das metrische Wir: Über die Quantifizierung des Sozialen (edition suhrkamp), :src https://images-na.ssl-images-amazon.com/images/I/61I8OUtaAbL._SS135_.jpg}, :content nil}]}]}]}]}]} {:tag :div, :attrs {:id itemMain_I1OKX5D9SF936Y, :class a-text-left a-fixed-left-grid-col g-item-sortable-padding a-col-right, :style padding-left:0%;float:left;}, :content [{:tag :div, :attrs {:id itemAlertDefault_I1OKX5D9SF936Y, :class a-box a-alert a-alert-error a-hidden a-spacing-mini, :aria-live assertive, :role alert}, :content [{:tag :div, :attrs {:class a-box-inner a-alert-container}, :content [{:tag :h4, :attrs {:class a-alert-heading}, :content [Ein Fehler trat auf, bitte versuchen Sie es zu einem späteren Zeitpunkt erneut]} {:tag :i, :attrs {:class a-icon a-icon-alert}, :content nil} {:tag :div, :attrs {:class a-alert-content}, :content nil}]}]} {:tag :div, :attrs {:id itemAlert_I1OKX5D9SF936Y, :class a-row a-spacing-mini a-hidden}, :content nil} {:tag :div, :attrs {:class a-fixed-right-grid}, :content [{:tag :div, :attrs {:class a-fixed-right-grid-inner, :style padding-right:220px}, :content [
;{:tag :div, :attrs {:id itemInfo_I1OKX5D9SF936Y, :class a-fixed-right-grid-col g-item-details a-col-left, :style padding-right:10%;float:left;}, :content [{:tag :div, :attrs {:class a-row}, :content [{:tag :div, :attrs {:class a-column a-span12 g-span12when-narrow g-span7when-wide}, :content [{:tag :div, :attrs {:class a-row a-size-small}, :content [{:tag :h3, :attrs {:class a-size-base}, :content [{:tag :a, :attrs {:id itemName_I1OKX5D9SF936Y, :class a-link-normal, :title Das metrische Wir: Über die Quantifizierung des Sozialen (edition suhrkamp), :href /dp/3518072927/?coliid=I1OKX5D9SF936Y&colid=13XXXLP6RR1X9&psc=1&ref_=lv_vv_lig_dp_it}, :content [Das metrische Wir: Über die Quantifizierung des Sozialen (edition suhrkamp)]}]} {:tag :span, :attrs {:id item-byline-I1OKX5D9SF936Y, :class a-size-base}, :content [von: Steffen Mau (Broschiert)]}]} {:tag :div, :attrs {:class a-row a-spacing-small a-size-small}, :content [  {:tag :div, :attrs {:class a-row}, :content [  {:tag :span, :attrs {:class a-declarative, :data-action a-popover, :data-a-popover {"cache":"true","max-width":"700","data":{"itemId":"I1OKX5D9SF936Y","isGridViewInnerPopover":""},"closeButton":"false","name":"review-hist-pop.3518072927","header":"","position":"triggerBottom","url":"/gp/customer-reviews/widgets/average-customer-review/popover/?asin=3518072927&contextId=wishlistList&link=1&seeall=1&ref_=lv_vv_lig_rh_rst"}}, :content [  {:tag :a, :attrs {:class a-link-normal g-visible-js reviewStarsPopoverLink, :href #}, :content [  {:tag :i, :attrs {:id review_stars_I1OKX5D9SF936Y, :class a-icon a-icon-star-small a-star-small-3-5}, :content [{:tag :span, :attrs {:class a-icon-alt}, :content [3.4 von 5 Sternen]}]} {:tag :i, :attrs {:class a-icon a-icon-popover, :role img}, :content nil}  ]}  ]}   {:tag :a, :attrs {:class a-link-normal g-visible-no-js, :href /product-reviews/3518072927/?colid=13XXXLP6RR1X9&coliid=I1OKX5D9SF936Y&showViewpoints=1&ref_=lv_vv_lig_pr_rc}, :content [  {:tag :i, :attrs {:class a-icon a-icon-star-small a-star-small-3-5}, :content [{:tag :span, :attrs {:class a-icon-alt}, :content [3.4 von 5 Sternen]}]}  ]}   {:tag :a, :attrs {:id review_count_I1OKX5D9SF936Y, :class a-size-base a-link-normal, :href /product-reviews/3518072927/?colid=13XXXLP6RR1X9&coliid=I1OKX5D9SF936Y&showViewpoints=1&ref_=lv_vv_lig_pr_rc}, :content [ 7 ]}  ]}   {:tag :div, :attrs {:class a-row}, :content [  {:tag :div, :attrs {:data-item-prime-info {"id":"I1OKX5D9SF936Y","asin":"3518072927"}, :class a-section price-section}, :content [  {:tag :span, :attrs {:id itemPrice_I1OKX5D9SF936Y, :class a-price, :data-a-size m, :data-a-color base}, :content [{:tag :span, :attrs {:class a-offscreen}, :content [18,00 €]} {:tag :span, :attrs {:aria-hidden true}, :content [{:tag :span, :attrs {:class a-price-symbol}, :content [€]} {:tag :span, :attrs {:class a-price-whole}, :content [18 {:tag :span, :attrs {:class a-price-decimal}, :content [,]}]} {:tag :span, :attrs {:class a-price-fraction}, :content [00]}]}]}   {:tag :span, :attrs {:class a-letter-space}, :content nil}   {:tag :i, :attrs {:class a-icon a-icon-prime a-icon-small, :role img}, :content nil}  ]}  ]}   {:tag :div, :attrs {:class a-row itemUsedAndNew}, :content [{:tag :a, :attrs {:id used-and-new_I1OKX5D9SF936Y, :class a-link-normal a-declarative itemUsedAndNewLink, :href /gp/offer-listing/3518072927/?colid=13XXXLP6RR1X9&coliid=I1OKX5D9SF936Y&ref_=lv_vv_lig_uan_ol}, :content [42 Angebote]} {:tag :span, :attrs {:class a-letter-space}, :content nil} ab  {:tag :span, :attrs {:class a-color-price itemUsedAndNewPrice}, :content [11,00 €]}]}]}]} {:tag :div, :attrs {:class a-column a-span12 g-span12when-narrow g-span5when-wide g-item-comment a-span-last}, :content [{:tag :div, :attrs {:class a-box a-box-normal a-color-alternate-background quotes-bubble}, :content [{:tag :div, :attrs {:class a-box-inner}, :content [{:tag :div, :attrs {:id itemCommentRow_I1OKX5D9SF936Y, :class a-row a-hidden}, :content [{:tag :span, :attrs {:class wrap-text}, :content [{:tag :span, :attrs {:id itemComment_I1OKX5D9SF936Y, :class g-comment-quote a-text-quote}, :content nil}]}]} {:tag :div, :attrs {:class a-row g-item-comment-row}, :content [{:tag :span, :attrs {:id itemPriorityRow_I1OKX5D9SF936Y, :class a-size-small}, :content [Wie sehr gewünscht: {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPriorityLabel_I1OKX5D9SF936Y, :class a-size-small dropdown-priority item-priority-high}, :content [Hätte ich sehr gerne]} {:tag :span, :attrs {:id itemPriority_I1OKX5D9SF936Y, :class a-hidden}, :content [1]}]} {:tag :i, :attrs {:class a-icon a-icon-text-separator g-priority-seperator a-hidden, :role img}, :content nil} {:tag :span, :attrs {:id itemQuantityRow_I1OKX5D9SF936Y, :class a-size-small a-hidden}, :content [{:tag :span, :attrs {:class aok-inline-block}, :content [{:tag :span, :attrs {:id itemRequestedLabel_I1OKX5D9SF936Y}, :content [Gewünscht:]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemRequested_I1OKX5D9SF936Y}, :content [1]}]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPurchasedSection_I1OKX5D9SF936Y, :class aok-inline-block}, :content [{:tag :span, :attrs {:id itemPurchasedLabel_I1OKX5D9SF936Y}, :content [Erhalten:]} {:tag :span, :attrs {:class a-letter-space}, :content nil} {:tag :span, :attrs {:id itemPurchased_I1OKX5D9SF936Y}, :content [0]}]}]}]} {:tag :div, :attrs {:class quotes-bubble-arrow}, :content nil}  ]}]}]}]}]} {:tag :div, :attrs {:id itemAction_I1OKX5D9SF936Y, :class a-fixed-right-grid-col dateAddedText a-col-right, :style width:220px;margin-right:-220px;float:left;}, :content [{:tag :span, :attrs {:id itemAddedDate_I1OKX5D9SF936Y, :class a-size-small}, :content [Artikel hinzugefügt 2. August 2017 ]} {:tag :div, :attrs {:class a-button-stack a-spacing-top-small}, :content [{:tag :span, :attrs {:class a-declarative, :data-action add-to-cart, :data-add-to-cart {"listID":"13XXXLP6RR1X9","canonicalAsin":"3518072927","itemID":"I1OKX5D9SF936Y","quantity":"1","merchantID":"A3JWKAKR8XB7XF","price":"18.00","productGroupID":"gl_book","offerID":"yY7j3Wwju4rlM9vMAVloLC2tLJcKnbJ1dgWrHa0N8QNZtagBTtV7ptfBWZNlmjnAqrsgjp24eM0BgfYGKIc%2FRFLVmDJ%2BB60r","isGift":"1","asin":"3518072927","promotionID":""}, :id pab-declarative-I1OKX5D9SF936Y}, :content [  {:tag :span, :attrs {:id pab-I1OKX5D9SF936Y, :class a-button a-button-normal a-button-primary wl-info-aa_add_to_cart}, :content [{:tag :span, :attrs {:class a-button-inner}, :content [{:tag :a, :attrs {:href /gp/item-dispatch?registryID.1=13XXXLP6RR1X9&registryItemID.1=I1OKX5D9SF936Y&offeringID.1=yY7j3Wwju4rlM9vMAVloLC2tLJcKnbJ1dgWrHa0N8QNZtagBTtV7ptfBWZNlmjnAqrsgjp24eM0BgfYGKIc%252FRFLVmDJ%252BB60r&session-id=258-1351578-9709240&isGift=1&submit.addToCart=1&quantity.1=1&ref_=lv_vv_lig_pab, :class a-button-text a-text-center, :role button}, :content [ In den Warenkorb ]}]}]}   {:tag :span, :attrs nil, :content nil}  ]} {:tag :div, :attrs {:class a-row a-spacing-small}, :content [{:tag :div, :attrs {:class a-row a-spacing-small g-touch-hide}, :content [{:tag :a, :attrs {:id lnkReserve_I1OKX5D9SF936Y, :class a-link-normal, :href https://www.amazon.de/ap/signin?clientContext=257-6828315-2108648&openid.return_to=https%3A%2F%2Fwww.amazon.de%2Fhz%2Fwishlist%2Fls%2F13XXXLP6RR1X9&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=amzn_wishlist_desktop_de&openid.mode=checkid_setup&marketPlaceId=A1PA6795UKMFR9&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&pageId=Amazon&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.pape.max_auth_age=900&siteState=clientContext%3D258-1351578-9709240%2CsourceUrl%3Dhttps%253A%252F%252Fwww.amazon.de%252Fhz%252Fwishlist%252Fls%252F13XXXLP6RR1X9%2Csignature%3Dz2mQdthDj2F9LkayNhoi0PHTbTk2kj3D}, :content [Dieses Geschenk woanders kaufen?]}]} {:tag :div, :attrs {:class a-row a-spacing-small g-touch-show}, :content [{:tag :div, :attrs {:class a-section a-spacing-top-small}, :content [{:tag :a, :attrs {:id lnkReserve_I1OKX5D9SF936Y, :class a-link-normal, :href https://www.amazon.de/ap/signin?clientContext=257-6828315-2108648&openid.return_to=https%3A%2F%2Fwww.amazon.de%2Fhz%2Fwishlist%2Fls%2F13XXXLP6RR1X9&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=amzn_wishlist_desktop_de&openid.mode=checkid_setup&marketPlaceId=A1PA6795UKMFR9&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&pageId=Amazon&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.pape.max_auth_age=900&siteState=clientContext%3D258-1351578-9709240%2CsourceUrl%3Dhttps%253A%252F%252Fwww.amazon.de%252Fhz%252Fwishlist%252Fls%252F13XXXLP6RR1X9%2Csignature%3Dz2mQdthDj2F9LkayNhoi0PHTbTk2kj3D}, :content [Dieses Geschenk woanders kaufen?]}]}]}]}]}]}]}]}]}]}]}]}]}]} {:tag :li, :attrs {:data-id 13XXXLP6RR1X9, :data-itemid I2PWST9R49BBX7, :data-price 16.0, :data-reposition-action-params {"itemExternalId":"ASIN:351812711X|A1PA6795UKMFR9","listType":"wishlist","sid":"258-1351578-9709240"}, :class a-spacing-none g-item-sortable}, :content [{:tag :span, :attrs {:class a-list-item}, :content [{:tag :hr, :attrs {:class a-spacing-none a-divider-normal}, :content nil} {:tag :div, :attrs {:id item_I2PWST9R49BBX7, :class a-section}, :content [  {:tag :div, :attrs {:class a-fixed-left-grid a-spacing-none}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-inner, :style padding-left:220px}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-col a-col-left, :style width:220px;margin-left:-220px;float:left;}, :content [{:tag :div, :attrs {:class a-fixed-left-grid}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-inner, :style padding-left:35px}, :content [{:tag :div, :attrs {:class a-fixed-left-grid-col a-col-left, :style width:35px;margin-left:-35px;float:left;}, :content nil} {:tag :div, :attrs {:id itemImage_I2PWST9R49BBX7, :class a-text-center a-fixed-left-grid-col g-itemImage wl-has-overlay g-item-sortable-padding a-col-right, :style padding-left:0%;float:left;}, :content [{:tag :a, :attrs {:class a-link-normal, :title »Für alle reicht es nicht«: Texte zum Kapitalismus (edition suhrkamp), :href /dp/351812711X/?coliid=I2PWST9R49BBX7&colid=13XXXLP6RR1X9&psc=1}, :content [{:tag :img, :attrs {:alt »Für alle reicht es nicht«: Texte zum Kapitalismus (edition suhrkamp), :src https://images-na.ssl-images-amazon.com/images/I/31g17z2UYHL._SS135_.jpg}, :content nil}]}]}]}]}]} {:tag :div, :attrs {:id itemMain_I2PWST9R49BBX7, :class a-text-left a-fixed-left-grid-col g-item-sortable-padding a-col-right, :style padding-left:0%;float:left;}, :content [{:tag :div, :attrs {:id itemAlertDefault_I2PWST9R49BBX7, :class a-box a-alert a-alert-error a-hidden a-spacing-mini, :aria-live assertive, :role alert}, :content [{:tag :div, :attrs {:class a-box-inner a-alert-container}, :content [{:tag :h4, :attrs {:class a-alert-heading}, :content [Ein Fehler trat auf, bitte versuchen Sie es zu einem späteren Zeitpunkt erneut]} {:tag :i, :attrs {:class a-icon a-icon-alert}, :content nil} {:tag :div, :attrs {:class a-alert-content}, :content nil}]}]} {:tag :div, :attrs {:id itemAlert_I2PWST9R49BBX7, :class a-row a-spacing-mini a-hidden}, :content nil} {:tag :div, :attrs {:class a-fixed-right-grid}, :content [{:tag :div, :attrs {:class a-fixed-right-grid-inner, :style padding-right:220px}, :content [



(quit driver)